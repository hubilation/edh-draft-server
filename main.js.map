{"version":3,"sources":["src/app.js","src/authentication.js","src/draft.js","src/index.js","src/mongoRepo.js","src/stateBuilder.js","src/test.js","src/validation.js"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["import express from \"express\";\r\nimport session from \"express-session\";\r\nimport bodyParser from \"body-parser\";\r\nimport path from \"path\";\r\nimport passport from \"passport\";\r\nimport {ensureLoggedIn} from 'connect-ensure-login';\r\n\r\nimport { Strategy } from \"passport-local\";\r\nimport {testConnection} from \"./src/mongoRepo\";\r\n\r\n\r\npassport.use(\r\n  new Strategy(function(username, password, done) {\r\n    return done(null, { id: 1, email: \"test\", name: \"steve\" });\r\n  })\r\n);\r\n\r\npassport.serializeUser(function(user, done) {\r\n  done(null, user.id);\r\n});\r\n\r\npassport.deserializeUser(function(id, done) {\r\n  done(null, { id: 1, email: \"test\", name: \"steve\" });\r\n});\r\n\r\nvar app = express();\r\n\r\n// app.configure(function(){\r\napp.use(bodyParser.urlencoded({ extended: false }));\r\napp.use(bodyParser.json());\r\napp.use(\r\n  session({ secret: \"loldrafting\", resave: false, saveUninitialized: false })\r\n);\r\napp.use(passport.initialize());\r\napp.use(passport.session());\r\n// });\r\n\r\napp.get(\"/login\", function(req, res) {\r\n  res.sendFile(path.join(__dirname, \"src\", \"login.html\"));\r\n});\r\n\r\napp.post(\r\n  \"/login\",\r\n  passport.authenticate(\"local\", {\r\n    successRedirect: \"/butts\",\r\n    failureRedirect: \"/fail\"\r\n  }),\r\n  function(req, res) {\r\n    console.log(\"got login\");\r\n  }\r\n);\r\n\r\napp.get(\r\n  \"/\",\r\n  ensureLoggedIn('/login'),\r\n  function(req, res) {\r\n    res.send(\"home page\");\r\n  }\r\n);\r\n\r\napp.get(\"/butts\", ensureLoggedIn('/login'), function(req, res) {\r\n  res.send(`hello ${req.user.name}, you logged in, sort of`);\r\n});\r\n\r\napp.get(\"/fail\", function(req, res) {\r\n  res.send(\"fuckin idiot\");\r\n});\r\n\r\n\r\ntestConnection();\r\n\r\napp.listen(5000);\r\n","// import passport from 'passport';\r\n// import {LocalStrategy} from 'passport-local';\r\n\r\n// passport.use(new LocalStrategy(\r\n//     function(username, password, done){\r\n//         return done(null, {email:\"test\", name:\"steve\"});\r\n//     }\r\n// ))\r\n\r\n","import { List, Map } from \"immutable\";\r\nimport {butt} from './test';\r\n\r\nexport function draft(state, cardId) {\r\n  let newState = state.merge(\r\n    Map({\r\n      \"activePick\": buildNextPick(state),\r\n      \"previousPicks\": addPreviousPick(state, cardId),\r\n      \"direction\": setDirectionIfNecessary(state)\r\n    })\r\n  );\r\n\r\n  return newState;\r\n}\r\n\r\nexport function addPreviousPick(state, cardId){\r\n  let previousPicks = state.get(\"previousPicks\");\r\n  let addedPick = previousPicks.splice(0, 0, setPick(state, cardId));\r\n\r\n  return addedPick;\r\n}\r\n\r\nexport function setPick(state, cardId) {\r\n  let currentPick = state.get(\"activePick\");\r\n\r\n  let picked = currentPick.merge({\r\n    cardId: cardId\r\n  });\r\n\r\n  return picked;\r\n}\r\n\r\nexport function buildNextPick(state) {\r\n  let currentPick = state.get(\"activePick\");\r\n  let lastPlayerId = currentPick.get(\"playerId\");\r\n  let pickOrder = state.get(\"pickOrder\");\r\n  let lastPlayerIndex = pickOrder.findIndex(p => p === lastPlayerId);\r\n\r\n  let direction = state.get(\"direction\");\r\n\r\n  let nextIndex = 0;\r\n  if (direction === \"ascending\") {\r\n    nextIndex = lastPlayerIndex + 1;\r\n    if (nextIndex >= pickOrder.size - 1) {\r\n      nextIndex = lastPlayerIndex;\r\n    }\r\n  } else {\r\n    nextIndex = lastPlayerIndex - 1;\r\n    if (nextIndex < 0) {\r\n      nextIndex = lastPlayerIndex;\r\n    }\r\n  }\r\n\r\n  return Map({\r\n    playerId: pickOrder.get(nextIndex),\r\n    pickId: currentPick.get(\"pickId\") + 1\r\n  });\r\n}\r\n\r\nexport function setDirectionIfNecessary(state) {\r\n  let currentPick = state.get(\"activePick\");\r\n  let lastPlayerId = currentPick.get(\"playerId\");\r\n  let pickOrder = state.get(\"pickOrder\");\r\n  let lastPlayerIndex = pickOrder.findIndex(p => p === lastPlayerId);\r\n  let direction = state.get(\"direction\");\r\n\r\n  let nextIndex = 0;\r\n  if (direction === \"ascending\") {\r\n    nextIndex = lastPlayerIndex + 1;\r\n    if (nextIndex > pickOrder.size - 1) {\r\n      return \"descending\";\r\n    }\r\n  } else {\r\n    nextIndex = lastPlayerIndex - 1;\r\n    if (nextIndex < 0) {\r\n      return \"ascending\"\r\n    }\r\n  }\r\n\r\n  return direction;\r\n}\r\n","import 'babel-polyfill';\r\nimport './app';\r\n","// import {MongoClient} from \"mongodb\";\r\n\r\nexport function testConnection(){\r\n    // MongoClient.connect(\"mongodb://165.227.24.220:27017/local\", function(err,db){\r\n    //     if(!err){\r\n    //         console.log(\"We connected!\");\r\n    //     }\r\n    // });\r\n}","import { List, Map, fromJS } from \"immutable\";\r\nimport { db } from \"../db\";\r\n\r\nexport function buildState(draftId){\r\n    var picks = getPicks(draftId);\r\n    var draft = getDraft(draftId);\r\n\r\n    return buildStateFromDraftAndPicks(draft,picks);\r\n}\r\n\r\nexport function getPicks(draftId){\r\n    var picks = fromJS(db.picks).filter(p=>p.get(\"draftId\") == draftId);\r\n\r\n    return picks;\r\n}\r\n\r\nexport function getDraft(draftId) {\r\n  var draft = fromJS(db.drafts).find(f => f.get(\"draftId\") == draftId);\r\n\r\n  return draft;\r\n}\r\n\r\nexport function buildStateFromDraftAndPicks(draft, picks) {\r\n  var sortedPicks = fromJS(picks).sort(\r\n    (a, b) => b.get(\"pickId\") - a.get(\"pickId\")\r\n  );\r\n  var lastPick = sortedPicks.get(0);\r\n\r\n  var direction = getDirection(draft, sortedPicks);\r\n\r\n  var state = Map({\r\n      activePick: getNextPick(draft, sortedPicks, direction),\r\n      previousPicks: sortedPicks,\r\n      direction: direction,\r\n      pickOrder: draft.get(\"players\")\r\n  });\r\n\r\n  return state;\r\n}\r\n\r\nexport function getDirection(draft, sortedPicks) {\r\n  var pickOrder = draft.get(\"players\");\r\n\r\n  var ratio = sortedPicks.get(0).get(\"pickId\") / pickOrder.size;\r\n\r\n  var ratioFloor = Math.floor(ratio);\r\n\r\n  if (ratioFloor % 2 == 0) {\r\n    return \"ascending\";\r\n  }\r\n\r\n  return \"descending\";\r\n}\r\n\r\nexport function getNextPick(draft, sortedPicks, direction) {\r\n  var pickOrder = draft.get(\"players\");\r\n  var latestPick = sortedPicks.get(0);\r\n  let lastPlayerIndex = pickOrder.findIndex(p => p === latestPick.get(\"playerId\"));\r\n  let nextPlayerIndex = -1;\r\n\r\n  if (direction == \"ascending\") {\r\n    nextPlayerIndex = lastPlayerIndex + 1;\r\n  } else {\r\n    nextPlayerIndex = lastPlayerIndex - 1;\r\n  }\r\n\r\n  return Map({\r\n    playerId: pickOrder.get(nextPlayerIndex),\r\n    pickId: latestPick.get(\"pickId\") + 1\r\n  });\r\n}\r\n","export function butt(){}","import { List, Map } from \"immutable\";\r\n\r\nexport function cardIsAvailable(cardId, picks){\r\n    var existingCard = picks.find(c=>c.get(\"cardId\") == cardId);\r\n\r\n    return existingCard == null;\r\n}\r\n\r\nexport function playerIsActivePlayer(playerId, activePick){\r\n    return activePick.get(\"playerId\") === playerId;\r\n}"]}